# RBAC

## 0. Подготовка стенда. Запускаем prepare.sh

## 1. Cоздайте на сервере master-1 пользователя devel и настройте ему доступ в кластер

Создайте ServiceAccount `devel` с доступом в неймспейс dev, с ролью `edit`
Получите токен и создайте контекст `devel` в конфигурации kubectl для пользователя `devel` с авторизацией по токену и кластера kubernetes

## 2. Cоздайте на сервере master-1 пользователя qa и настройте ему доступ в кластер

Создайте ServiceAccount `qa` в неймспейсе `prod`, с доступом в неймспейс `dev`, с ролью `edit` и с доступом в неймспейс `prod`, с ролью `view`.
Получите токен и создайте контекст `qa` в конфигурации kubectl для пользователя `qa` с авторизацией по токену и кластера kubernetes

## 3. Создайте ингресс для доступа к API через ингресс контроллер из манифеста ingress.yml.

Поменяйте в манифесте в двух местах название хоста s<номер студента> на свой номер логина и примените его в кластер.

## 4. Создайте запись kube-ext в списке кластеров, указав адрес из ингресса и опцию --insecure-skip-tls-verify=true

## 5. Создайте контексты qa-ext и devel-ext для юзеров qa и devel с кластером kube-ext

## 6. Рассмотрите конфиг kubectl

Полный:
```
kubectl config view
```

Текущий контекст
```
kubectl config view --minify
```

Конфиг для `qa`, с полными данными и доступом снаружи
```
kubectl use-context qa-ext
kubectl config view --minify --raw
```

## 7. Выгрузите конфиг контекста qa-ext на sbox.slurm.io и проверьте доступы в кластер.

## 8. Задача со звездочкой

На базе роли `edit` создайте роль `edit-nosecrets`, которая не позволяет изменять секреты, а позволяет только просматривать. 
Назначьте её serviceAccount'у `qa` для доступа в неймспейс `dev`.

## 9. Задача с двумя звездочками

Сгенерируйте сертификат и подпишите его корневым ключом кластера для авторизации пользователя
из группы `system:masters`
